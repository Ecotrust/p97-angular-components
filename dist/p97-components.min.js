angular.module("vpApi.services",[]).factory("vpApi",["$http",function(t){function o(o,e,n){console.log("I should log in");var u=c+"authenticate/";r.username=o.username;var s={Authorization:"Token "+r.token};t.post(u,o,s).success(function(t,o){r.token=t.token,localStorage.setItem("token",t.token),e(t,o)}).error(function(t,o){n(t,o)})}function e(o,e,n,u){var s=c+o+"/",a={headers:{Authorization:"Token "+r.token}};t.get(s,a).success(function(t,o){n(t,o)}).error(function(t,o){u(t,o)})}function n(o,e,n,u){{var s=c+o+"/";({headers:{Authorization:"Token "+r.token}})}t({url:s,method:"POST",data:e,headers:{Authorization:"Token "+r.token}}).success(function(t,o){n(t,o)}).error(function(t,o){u(t,o)})}var r={username:null,token:null,profile:null};localStorage.getItem("token")&&(r.token=localStorage.getItem("token"));var c="http://localhost:8000/api/v2/";return{apiBase:c,authenticate:o,user:r,fetch:e,post:n}}]).service("$formstack",["vpApi","$localStorage",function(t,o){var e=this;this.resource_name="pforms/formstack",this.objects=[],this.loadBySlug=function(n,r){t.fetch(this.resource_name,{slug:n},function(t,n){e.objects=t,console.log("[loadBySlug] got data"),console.log(t),o.setObject("formstack",t[0]),r(t[0],n)},function(t,o){console.log("Failed to fetch "+e.resource_name+". Returned Status: "+o),console.log(t)})},this.getBySlug=function(t,o){return res=_.find(this.objects,function(e){return e[t]===o}),res||[]},this.fetchUpdates=function(t,o){console.log("[fetchUpdates] getting data"),this.loadBySlug(t,o)},this.getFormBySlug=function(t){var o=_.find(this.objects[0].forms,function(o){return o.slug===t});return o}}]).factory("Form",["vpApi",function(){function t(t,o,e){return console.log("getById"),res=_.find(t,function(t){return t[o]===e}),res||[]}var o=[];return{get:t,objects:o}}]).factory("Question",["vpApi",function(t){function o(o){t.fetch(c,{},function(t,e){u=t,o(t,e)},function(t,o){console.log("Failed to fetch "+c+". Returned Status: "+o),console.log(t)})}function e(o,e){t.post(c,o,function(t,o){e(t,o)},function(t,o){console.log("Failed to create "+c+". Returned Status: "+o),console.log(t),e(t,o)})}function n(t,o){return res=_.find(u,function(e){return e[t]===o}),res||[]}function r(t){return t.options={placeholder:""},t.type=parseInt(t.type),t}var c="pforms/question",u=[];return{load:o,create:e,get:n,objects:u,cleanData:r}}]).factory("$localStorage",["$window",function(t){return{set:function(o,e){t.localStorage[o]=e},get:function(o,e){return t.localStorage[o]||e},setObject:function(o,e){t.localStorage[o]=JSON.stringify(e)},getObject:function(o){return JSON.parse(t.localStorage[o]||"{}")}}}]);