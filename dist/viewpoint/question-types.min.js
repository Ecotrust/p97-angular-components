angular.module("p97.questionTypes",["monospaced.elastic"]),angular.module("p97.questionTypes").directive("qtLoader",function(e){return{restrict:"E",scope:{questions:"="},template:"<div class='row blocks'></div>",controller:function(t,n){t.addDirectives=function(){_.each(t.questions,function(r,o){r.form={show:!0},"undefined"==typeof r.value&&(r.value="");var a='<div class="question '+r.type+'" '+r.type+' question="questions['+o+']" value="questions['+o+'].value" control="questions['+o+'].form" ng-show="questions['+o+'].form.show"></div>',l=e(a)(t);n.parent().append(l)})},t.addDirectives()}}}),angular.module("p97.questionTypes").directive("datetime",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.question){var l=o.question.options;o.errors=[],o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"datetime/templates/"+o.question.options.templateUrl+".html":BASE_URL+"datetime/templates/ionic/datetime.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[];var e=l.datejs_format||"MM/dd/yyyy HH:mm:ss",t=Date.parseExact(o.value,e);return l.required===!0?((null===t||isNaN(t))&&o.errors.push("Invalid format."),0===o.value.length&&o.errors.push("This field is required")):o.value.length>0&&(null===t||0/0===t)&&o.errors.push("Invalid format."),0===o.errors.length},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("number",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.question){var l=o.question.options;o.errors=[],o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"number/templates/"+o.question.options.templateUrl+".html":BASE_URL+"number/templates/ionic/number.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){return o.errors=[],("number"!=typeof o.value||isNaN(o.value))&&l.required&&l.required===!0?(o.errors.push("input must be a number"),!1):"number"==typeof o.value||l.required&&l.required!==!1?(l.min&&"number"==typeof l.min&&o.value<l.min&&o.errors.push("value must not be less than "+l.min),l.max&&o.value>l.max&&o.errors.push("value must not be more than "+l.max),0===o.errors.length):(o.errors.push("input must be a number"),!1)},o.internalControl.clean_answer=function(){o.value=parseFloat(o.value,10)},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("textarea",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"textarea/templates/"+o.question.options.templateUrl+".html":BASE_URL+"textarea/templates/ionic/textarea.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.question){var l=o.question.options;o.errors=[],o.char_count=0,o.word_count=0,o.internalControl=o.control||{},o.internalControl.validate_answer=function(){if(o.errors=[],null===o.value&&(o.value=""),l.min_word&&o.word_count<l.min_word&&o.errors.push("You must have at least "+l.min_word+" words. You have "+o.word_count),l.max_word){var e=l.max_count||500;o.word_count>e?o.errors.push("You can have up to "+e+" words. You currently have "+o.word_count):o.word_count>l.max_word&&o.errors.push("You can only have "+l.max_word+" words. You have "+o.word_count)}return!l.min_word&&l.min_char&&o.char_count<l.min_char&&o.errors.push("You must have at least "+l.min_char+" characters. You have "+o.char_count),!l.max_word&&l.max_char&&o.char_count>l.max_char&&o.errors.push("You can only have "+l.max_char+" characters. You have "+o.char_count),0===o.errors.length},o.internalControl.clean_answer=function(){},o.$watch("value",function(e){if(e){var t,n=e.length;t=0===n?0:o.value.split(" ").length||0,o.char_count=n,o.word_count=t}}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("yesNo",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"yes-no/templates/"+o.question.options.templateUrl+".html":BASE_URL+"yes-no/templates/ionic/yes-no.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.question){var l=o.question.options;o.errors=[],o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[],l.required&&l.required===!0&&null===o.value&&o.errors.push("This field is required")},o.internalControl.clean_answer=function(){null===o.value&&(o.value=!1)},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("singleSelect",["$http","$templateCache","$compile","$injector","$sce",function(e,t,n,r,o){if(r.has("$ionicPopup"))var a=r.get("$ionicPopup");return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,l){var u=/^[A-Za-z\d() _.,-]*$/,i=r.question.options;if(r.errors=[],r.localChoices=angular.copy(r.question.choices),r.obj={otherValue:null},r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"single-select/templates/"+r.question.options.templateUrl+".html":BASE_URL+"single-select/templates/ionic/radio.html"},r.renderHtml=function(e){return o.trustAsHtml(e)},r.question){if(1===r.question.choices.length&&(r.value=r.question.choices[0].value),i.allow_other>0){var s={verbose:"Other",value:"other"};r.localChoices.push(s)}r.checkPreviousAnswer=function(){if(r.value&&""!==r.value){if(choiceValues=_.pluck(r.localChoices,"value"),!_.contains(choiceValues,r.value)){var e={verbose:"User Entered: "+r.value,value:r.value};r.localChoices.splice(r.localChoices.length-1,0,e)}r.inputValue=r.value}},r.internalControl=r.control||{},r.internalControl.validate_answer=function(){return r.errors=[],i.required&&i.required===!0&&null===r.value&&r.errors.push("This field is required"),u.test(r.value)||r.errors.push("Your 'Other' input is invalid. Please try again without using special characters or symbols"),"other"===r.inputValue&&(r.otherValue&&null!==r.otherValue||r.errors.push("You selected 'Other'. It cannot be blank. Please fill in a response or select another choice")),0===r.errors.length},r.internalControl.clean_answer=function(){},r.otherInputModal=function(){a.show({template:'<input type="text" ng-model="obj.otherValue">',title:"Other Option",scope:r,subTitle:"Please enter your input below",buttons:[{text:"Cancel",onTap:function(){return r.value="",!1}},{text:"<b>Confirm</b>",type:"button-positive",onTap:function(){if(0==r.otherValueCheck())return!1;_.each(r.localChoices,function(e){return"User Entered:"===e.verbose.substring(0,13)&&(r.localChoices=_.reject(r.localChoices,e)),r.localChoices});var e={verbose:"User Entered: "+r.obj.otherValue,value:r.obj.otherValue};r.localChoices.splice(r.localChoices.length-1,0,e),r.inputValue=r.obj.otherValue,r.obj.otherValue=""}}]})},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();n(t)(r)}),r.$watch("inputValue",function(e){"other"===e?r.otherInputModal():r.value=e}),r.otherValueCheck=function(){if(r.obj.otherValue.length>0){if(localContains=_.some(r.localChoices,function(e){return e.value==r.obj.otherValue}))return a?a.alert({title:"Duplicate Entries",template:"You have typed a duplicate answer. Please try again."}):alert("You have typed a duplicate answer. Please try again."),r.obj.otherValue="",r.value="",!1;if(r.obj.otherValue.length>r.question.options.other_max_length)return a?a.alert({title:"Too long",template:"You have typed an answer that is too long. Please try again."}):alert("You have typed an answer that is too long. Please try again."),!1}},r.checkPreviousAnswer()}}}}]),angular.module("p97.questionTypes").directive("text",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"text/templates/"+o.question.options.templateUrl+".html":BASE_URL+"text/templates/ionic/text.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.question){var l=o.question.options;o.errors=[],o.char_count=0,o.word_count=0,o.internalControl=o.control||{},o.internalControl.validate_answer=function(){if(o.errors=[],null===o.value&&(o.value=""),l.min_word&&o.word_count<l.min_word&&o.errors.push("You must have at least "+l.min_word+" words. You have "+o.word_count),l.max_word){var e=l.max_count||20;o.word_count>e?o.errors.push("You can have up to "+e+" words. You currently have "+o.word_count):o.word_count>l.max_word&&o.errors.push("You can only have "+l.max_word+" words. You have "+o.word_count)}return!l.min_word&&l.min_char&&o.char_count<l.min_char&&o.errors.push("You must have at least "+l.min_char+" characters. You have "+o.char_count),!l.max_word&&l.max_char&&o.char_count>l.max_char&&o.errors.push("You can only have "+l.max_char+" characters. You have "+o.char_count),0===o.errors.length},o.internalControl.clean_answer=function(){},o.$watch("value",function(e){if(e){var t,n=e.length;t=0===n?0:o.value.split(" ").length||0,o.char_count=n,o.word_count=t}}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("integer",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.question){var l=o.question.options;o.errors=[],o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"integer/templates/"+o.question.options.templateUrl+".html":BASE_URL+"integer/templates/ionic/integer.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){if(o.errors=[],isInteger=function(e){return y=parseInt(e),"number"==typeof y&&y%1===0},!isInteger(o.value)&&l.required&&l.required===!0)return o.errors.push("input must be a integer"),!1;if(null!==o.value&&void 0!==o.value&&o.value.length>0){if(!(isInteger(o.value)||l.required&&l.required!==!1))return o.errors.push("input must be a integer"),!1;l.min&&isInteger(l.min)&&o.value<l.min&&o.errors.push("value must not be less than "+l.min),l.max&&isInteger(l.max)&&o.value>l.max&&o.errors.push("value must not be more than "+l.max)}return 0===o.errors.length},o.internalControl.clean_answer=function(){},o.$watch("dummyValue",function(e){e&&(o.value=e)}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]);var reg=angular.module("p97.questionTypes").directive("email",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.question){var l=o.question.options;o.errors=[],o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"email/templates/"+o.question.options.templateUrl+".html":BASE_URL+"email/templates/ionic/email.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[];var e=/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;return!e.test(o.value)&&l.required&&l.required===!0?(o.errors.push("input must be a valid email"),!1):e.test(o.value)||l.required&&l.required!==!1?0===o.errors.length:(o.errors.push("input must be a valid email"),!1)},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]);angular.module("p97.questionTypes").directive("date",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.question){var l=o.question.options,u=/^(19|20)\d{2}$/;o.errors=[],o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"date/templates/"+o.question.options.templateUrl+".html":BASE_URL+"date/templates/ionic/date.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[];var e=l.datejs_format||"MM/dd/yyyy";if(l&&l.required===!0&&(null==o.value||""==o.value))return o.errors.push("This field is required"),!1;if(null!==o.value&&void 0!==o.value&&o.value.length>0){var t=Date.parseExact(o.value,e);(null==t||isNaN(t))&&o.errors.push("You date is in an invalid format"),e&&"yyyy"===e&&(u.test(o.value)||o.errors.push("Input must be a valid year"),l.min&&u.test(l.min)&&o.value<l.min&&o.errors.push("Year must not be lower than "+l.min),l.max&&u.test(l.max)&&o.value>l.max&&o.errors.push("Year must not be higher than "+l.max))}return 0===o.errors.length},o.internalControl.clean_answer=function(){},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("phonenumber",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.question){var l=o.question.options;o.errors=[];var u=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,i=/^[0-9 ]+$/;o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"phonenumber/templates/"+o.question.options.templateUrl+".html":BASE_URL+"phonenumber/templates/ionic/phonenumber.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.internalControl=o.control||{},o.internalControl.validate_answer=function(){o.errors=[];l.default||"North America";return l.required&&l.required===!0&&null===o.value?(o.errors.push("This field is required"),!1):(l.format&&"North America"===l.format&&(u.test(o.value)||o.errors.push("input must be a valid North America phonenumber")),l.format&&"International"===l.format&&(i.test(o.value)||o.errors.push("input must be a valid International phonenumber")),0===o.errors.length)},o.internalControl.parse_phone=function(){if(l.format&&"North America"===l.format&&u.test(o.value)){var e="+"+l.country+" "+o.value.replace(u,"$1 $2$3");o.parsed_array=e.split(" ")}if(l.format&&"International"===l.format&&i.test(o.value)){var e="+"+l.country+" "+o.value;o.parsed_array=e.split(" ")}return o.parsed_array},o.internalControl.clean_answer=function(){return o.internalControl.cleaned_value=o.internalControl.parse_phone(),o.internalControl.cleaned_value},e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]),angular.module("p97.questionTypes").directive("multiSelect",["$http","$templateCache","$compile","$injector","$sce",function(e,t,n,r,o){if(r.has("$ionicPopup"))var a=r.get("$ionicPopup");return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,l){if(options=r.question.options,reg=/^[A-Za-z\d() _.,-]*$/,r.showOtherInput=!1,r.choicesSelected=0,r.errors=[],r.valueArray=[],r.obj={otherValue:null},r.localChoices=angular.copy(r.question.choices),r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"multi-select/templates/"+r.question.options.templateUrl+".html":BASE_URL+"multi-select/templates/ionic/toggle-multi.html"},r.renderHtml=function(e){return o.trustAsHtml(e)},r.question){if(1===r.question.choices.length&&(r.value=r.question.choices[0].value),options.allow_other>0){var u={verbose:"Other",value:"other"};r.localChoices.push(u)}r.internalControl=r.control||{},r.internalControl.validate_answer=function(){return r.errors=[],options.required&&options.required===!0&&0===r.value.length&&r.errors.push("This field is required"),options.max_choice&&r.choicesSelected>options.max_choice&&r.errors.push("You can have up to "+options.max_choice+" choices. You currently have "+r.choicesSelected),options.min_choice&&r.choicesSelected<options.min_choice&&r.errors.push("You need at least "+options.min_choice+" choices. You currently have "+r.choicesSelected),r.value.length>0&&_.each(r.value,function(e){reg.test(e)?("other"===e&&!r.otherValue||null===r.otherValue)&&r.errors.push("You selected 'Other'. Please fill in a response or type in another choice"):r.errors.push("Your 'Other' input is invalid. Please try again without using special characters or symbols")}),0===r.errors.length},r.internalControl.clean_answer=function(){},r.addChoicesToArray=function(e){r.value&&""!==r.value&&(r.valueArray=r.value);var t=r.valueArray.indexOf(e);t>-1?r.valueArray.splice(t,1):r.valueArray.push(e),r.valueArray.length>0?r.value=r.valueArray:r.value},r.otherInputModal=function(){a.show({template:'<input type="text" ng-model="obj.otherValue">',title:"Other Option",scope:r,subTitle:"Please enter your input below",buttons:[{text:"Cancel",onTap:function(){r.cancelOther()}},{text:"<b>Confirm</b>",type:"button-positive",onTap:function(){if(0==r.otherValueCheck())return!1;var e={verbose:"User Entered: "+r.obj.otherValue,value:r.obj.otherValue,checked:!0};r.localChoices.splice(r.localChoices.length-1,0,e),r.value[r.value.indexOf("other")]=r.obj.otherValue,r.localChoices[r.localChoices.length-1].checked=!1,r.obj.otherValue=""}}]})},r.otherValueCheck=function(){if(r.obj.otherValue.length>0){if(_.contains(r.value,r.obj.otherValue))return a?a.alert({title:"Duplicate Entries",template:"You have typed a duplicate answer. Please try again."}):alert("You have typed a duplicate answer. Please try again."),r.obj.otherValue="",r.cancelOther(),!1;if(r.obj.otherValue.length>options.other_max_length)return a?a.alert({title:"Too long",template:"You have typed an answer that is too long. Please try again."}):alert("You have typed an answer that is too long. Please try again."),r.cancelOther(),!1}},r.$watch("valueArray",function(e){if(e){var t=e.length;r.choicesSelected=t,_.contains(e,"other")&&r.otherInputModal()}},!0),e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=l.html(e).contents();n(t)(r)}),r.togglePrevAnswers=function(){_.each(r.localChoices,function(e){e.checked=!1}),_.each(r.value,function(e){if(choiceValues=_.pluck(r.localChoices,"value"),_.contains(choiceValues,e)){var t=_.find(r.localChoices,function(t){return t.value===e});t.checked=!0}else{var n={verbose:"User Entered: "+e,value:e,checked:!0};r.localChoices.splice(r.localChoices.length-1,0,n)}})},r.cancelOther=function(){r.localChoices[r.localChoices.length-1].checked=!1,r.value=_.compact(_.without(r.value,"other")),r.valueArray=_.compact(_.without(r.valueArray,"other"))},r.togglePrevAnswers()}}}}]),angular.module("p97.questionTypes").directive("toggle",["$http","$templateCache","$compile","$sce",function(e,t,n,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(o,a){if(o.getContentUrl=function(){return o.question.options.templateUrl?BASE_URL+"toggle/templates/"+o.question.options.templateUrl+".html":BASE_URL+"toggle/templates/ionic/toggle.html"},o.renderHtml=function(e){return r.trustAsHtml(e)},o.question){{o.question.options}o.errors=[],"undefined"!=typeof o.question.value&&(o.localValue=o.question.value),o.internalControl=o.control||{},o.internalControl.validate_answer=function(){return o.value===o.question.options.positiveValue||o.value===o.question.options.negativeValue?!0:void 0},o.internalControl.clean_answer=function(){null===o.value&&(o.value=!1)},o.$watch("localValue",function(e){"undefined"!=typeof e&&(o.value=e===!0?o.question.options.positiveValue||!0:o.question.options.negativeValue||!1,console.log(o.value))}),e.get(o.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(o)})}}}}]);