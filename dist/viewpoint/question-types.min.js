angular.module("p97.questionTypes",[]),angular.module("p97.questionTypes").directive("qtLoader",function(e){return{restrict:"E",scope:{questions:"="},template:"<div class='row blocks'></div>",controller:function(t,n){t.addDirectives=function(){_.each(t.questions,function(r,o){r.form={show:!0},"undefined"==typeof r.value&&(r.value="");var a="<div "+r.type+' question="questions['+o+']" value="questions['+o+'].value" control="questions['+o+'].form" ng-show="questions['+o+'].form.show"></div>',l=e(a)(t);n.parent().append(l)})},t.addDirectives()}}}),angular.module("p97.questionTypes").directive("datetime",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"datetime/templates/"+r.question.options.templateUrl+".html":BASE_URL+"datetime/templates/ionic/datetime.html"},r.question){var a=r.question.options;r.errors=[],r.internalControl=r.control||{},r.internalControl.validate_answer=function(){r.errors=[];var e=a.datejs_format||"MM/dd/yyyy HH:mm:ss",t=Date.parseExact(r.value,e);return a.required===!0?((null===t||isNaN(t))&&r.errors.push("Invalid format."),0===r.value.length&&r.errors.push("This field is required")):r.value.length>0&&(null===t||0/0===t)&&r.errors.push("Invalid format."),0===r.errors.length},r.internalControl.clean_answer=function(){},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]),angular.module("p97.questionTypes").directive("number",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"number/templates/"+r.question.options.templateUrl+".html":BASE_URL+"number/templates/ionic/number.html"},r.question){var a=r.question.options;r.errors=[],r.internalControl=r.control||{},r.internalControl.validate_answer=function(){return r.errors=[],("number"!=typeof r.value||isNaN(r.value))&&a.required&&a.required===!0?(r.errors.push("input must be a number"),!1):"number"==typeof r.value||a.required&&a.required!==!1?(a.min&&"number"==typeof a.min&&r.value<a.min&&r.errors.push("value must not be less than "+a.min),a.max&&r.value>a.max&&r.errors.push("value must not be more than "+a.max),0===r.errors.length):(r.errors.push("input must be a number"),!1)},r.internalControl.clean_answer=function(){r.value=parseFloat(r.value,10)},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]),angular.module("p97.questionTypes").directive("textarea",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"textarea/templates/"+r.question.options.templateUrl+".html":BASE_URL+"textarea/templates/ionic/textarea.html"},r.question){var a=r.question.options;r.errors=[],r.char_count=0,r.word_count=0,r.internalControl=r.control||{},r.internalControl.validate_answer=function(){if(r.errors=[],null===r.value&&(r.value=""),a.min_word&&r.word_count<a.min_word&&r.errors.push("You must have at least "+a.min_word+" words. You have "+r.word_count),a.max_word){var e=a.max_count||500;r.word_count>e?r.errors.push("You can have up to "+e+" words. You currently have "+r.word_count):r.word_count>a.max_word&&r.errors.push("You can only have "+a.max_word+" words. You have "+r.word_count)}return!a.min_word&&a.min_char&&r.char_count<a.min_char&&r.errors.push("You must have at least "+a.min_char+" characters. You have "+r.char_count),!a.max_word&&a.max_char&&r.char_count>a.max_char&&r.errors.push("You can only have "+a.max_char+" characters. You have "+r.char_count),0===r.errors.length},r.internalControl.clean_answer=function(){},r.$watch("value",function(e){if(e){var t,n=e.length;t=0===n?0:r.value.split(" ").length||0,r.char_count=n,r.word_count=t}}),e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]),angular.module("p97.questionTypes").directive("yesNo",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"yes-no/templates/"+r.question.options.templateUrl+".html":BASE_URL+"yes-no/templates/ionic/yes-no.html"},r.question){var a=r.question.options;r.errors=[],r.internalControl=r.control||{},r.internalControl.validate_answer=function(){r.errors=[],a.required&&a.required===!0&&null===r.value&&r.errors.push("This field is required")},r.internalControl.clean_answer=function(){null===r.value&&(r.value=!1)},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]),angular.module("p97.questionTypes").directive("singleSelect",["$http","$templateCache","$compile","$injector",function(e,t,n,r){if(r.has("$ionicPopup"))var o=r.get("$ionicPopup");return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,a){var l=/^[A-Za-z\d() _.,-]*$/,i=r.question.options;if(r.errors=[],r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"single-select/templates/"+r.question.options.templateUrl+".html":BASE_URL+"single-select/templates/ionic/drop-down-single.html"},r.question){if(1===r.question.choices.length&&(r.value=r.question.choices[0].value),i.allow_other>0){var u={verbose:"Other",value:"other"};r.question.choices.push(u)}r.internalControl=r.control||{},r.internalControl.validate_answer=function(){return r.errors=[],i.required&&i.required===!0&&null===r.value&&r.errors.push("This field is required"),l.test(r.value)||r.errors.push("Your 'Other' input is invalid. Please try again without using special characters or symbols"),"other"===r.inputValue&&(r.otherValue&&null!==r.otherValue||r.errors.push("You selected 'Other'. It cannot be blank. Please fill in a response or select another choice")),0===r.errors.length},r.internalControl.clean_answer=function(){},r.internalControl.unclean_answer=function(){if(choiceValues=_.pluck(r.question.choices,"value"),choiceValues.indexOf(r.value)>-1){var e={verbose:"User Entered",value:r.value};r.question.choices.splice(r.question.choices.length-1,0,e)}return r.question.choices},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(r)}),r.$watch("inputValue",function(e){r.value="other"===e?r.otherValue:e}),r.otherValueBlur=function(){if(setValue=function(){var e={verbose:"User Entered: "+r.otherValue,value:r.otherValue};r.question.choices.splice(r.question.choices.length-1,0,e),r.inputValue=r.otherValue,r.otherValue=""},r.otherValue.length>0){if(r.otherValue.length>r.question.options.other_max_length)return o?o.alert({title:"Too long",template:"You have typed an answer that is too long. Please try again."}):alert("You have typed an answer that is too long. Please try again."),!1;if(o){var e=o.confirm({title:"Are You Sure",template:"Are you sure you want this selection?"});e.then(function(e){e&&setValue()})}else{var t=window.confirm("Are You Sure","Are you sure you want this selection");1==t&&setValue()}}}}}}}]),angular.module("p97.questionTypes").directive("text",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"text/templates/"+r.question.options.templateUrl+".html":BASE_URL+"text/templates/ionic/text.html"},r.question){var a=r.question.options;r.errors=[],r.char_count=0,r.word_count=0,r.internalControl=r.control||{},r.internalControl.validate_answer=function(){if(r.errors=[],null===r.value&&(r.value=""),a.min_word&&r.word_count<a.min_word&&r.errors.push("You must have at least "+a.min_word+" words. You have "+r.word_count),a.max_word){var e=a.max_count||20;r.word_count>e?r.errors.push("You can have up to "+e+" words. You currently have "+r.word_count):r.word_count>a.max_word&&r.errors.push("You can only have "+a.max_word+" words. You have "+r.word_count)}return!a.min_word&&a.min_char&&r.char_count<a.min_char&&r.errors.push("You must have at least "+a.min_char+" characters. You have "+r.char_count),!a.max_word&&a.max_char&&r.char_count>a.max_char&&r.errors.push("You can only have "+a.max_char+" characters. You have "+r.char_count),0===r.errors.length},r.internalControl.clean_answer=function(){},r.$watch("value",function(e){if(e){var t,n=e.length;t=0===n?0:r.value.split(" ").length||0,r.char_count=n,r.word_count=t}}),e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]),angular.module("p97.questionTypes").directive("integer",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"integer/templates/"+r.question.options.templateUrl+".html":BASE_URL+"integer/templates/ionic/integer.html"},r.question){var a=r.question.options;r.errors=[],r.internalControl=r.control||{},r.internalControl.validate_answer=function(){function e(e){return"number"==typeof e&&e%1===0}return r.errors=[],!e(r.value)&&a.required&&a.required===!0?(r.errors.push("input must be a integer"),!1):e(r.value)||a.required&&a.required!==!1?(a.min&&e(a.min)&&r.value<a.min&&r.errors.push("value must not be less than "+a.min),a.max&&e(a.max)&&r.value>a.max&&r.errors.push("value must not be more than "+a.max),0===r.errors.length):(r.errors.push("input must be a integer"),!1)},r.internalControl.clean_answer=function(){r.value=parseFloat(r.value,10)},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]);var reg=angular.module("p97.questionTypes").directive("email",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"email/templates/"+r.question.options.templateUrl+".html":BASE_URL+"email/templates/ionic/email.html"},r.question){var a=r.question.options;r.errors=[],r.internalControl=r.control||{},r.internalControl.validate_answer=function(){r.errors=[];var e=/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;return!e.test(r.value)&&a.required&&a.required===!0?(r.errors.push("input must be a valid email"),!1):e.test(r.value)||a.required&&a.required!==!1?0===r.errors.length:(r.errors.push("input must be a valid email"),!1)},r.internalControl.clean_answer=function(){},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]);angular.module("p97.questionTypes").directive("date",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"date/templates/"+r.question.options.templateUrl+".html":BASE_URL+"date/templates/ionic/date.html"},r.question){var a=r.question.options;r.errors=[],r.internalControl=r.control||{},r.internalControl.validate_answer=function(){r.errors=[];var e=a.datejs_format||"MM/dd/yyyy",t=Date.parseExact(r.value,e);return a.required===!0?((null===t||isNaN(t))&&r.errors.push("Invalid format."),0===r.value.length&&r.errors.push("This field is required")):r.value.length>0&&(null===t||0/0===t)&&r.errors.push("Invalid format."),0===r.errors.length},r.internalControl.clean_answer=function(){},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]),angular.module("p97.questionTypes").directive("phonenumber",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"phonenumber/templates/"+r.question.options.templateUrl+".html":BASE_URL+"phonenumber/templates/ionic/phonenumber.html"},r.question){var a=r.question.options;r.errors=[];var l=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,i=/^[0-9 ]+$/;r.internalControl=r.control||{},r.internalControl.validate_answer=function(){r.errors=[];a.default||"North America";return a.required&&a.required===!0&&null===r.value?(r.errors.push("This field is required"),!1):(a.format&&"North America"===a.format&&(l.test(r.value)||r.errors.push("input must be a valid North America phonenumber")),a.format&&"International"===a.format&&(i.test(r.value)||r.errors.push("input must be a valid International phonenumber")),0===r.errors.length)},r.internalControl.parse_phone=function(){if(a.format&&"North America"===a.format&&l.test(r.value)){var e="+"+a.country+" "+r.value.replace(l,"$1 $2$3");r.parsed_array=e.split(" ")}if(a.format&&"International"===a.format&&i.test(r.value)){var e="+"+a.country+" "+r.value;r.parsed_array=e.split(" ")}return r.parsed_array},r.internalControl.clean_answer=function(){return r.internalControl.cleaned_value=r.internalControl.parse_phone(),r.internalControl.cleaned_value},e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]),angular.module("p97.questionTypes").directive("multiSelect",["$http","$templateCache","$compile","$injector",function(e,t,n,r){if(r.has("$ionicPopup"))var o=r.get("$ionicPopup");return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,a){if(options=r.question.options,reg=/^[A-Za-z\d() _.,-]*$/,r.showOtherInput=!1,r.choicesSelected=0,r.errors=[],r.valueArray=[],r.localChoices=r.question.choices,r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"multi-select/templates/"+r.question.options.templateUrl+".html":BASE_URL+"multi-select/templates/ionic/toggle-multi.html"},r.question){if(1===r.question.choices.length&&(r.value=r.question.choices[0].value),options.allow_other>0){var l={verbose:"Other",value:"other"};r.localChoices.push(l)}r.internalControl=r.control||{},r.internalControl.validate_answer=function(){return r.errors=[],options.required&&options.required===!0&&0===r.value.length&&r.errors.push("This field is required"),options.max_choice&&r.choicesSelected>options.max_choice&&r.errors.push("You can have up to "+options.max_choice+" choices. You currently have "+r.choicesSelected),options.min_choice&&r.choicesSelected<options.min_choice&&r.errors.push("You need at least "+options.min_choice+" choices. You currently have "+r.choicesSelected),r.value.length>0&&_.each(r.value,function(e){reg.test(e)?("other"===e&&!r.otherValue||null===r.otherValue)&&r.errors.push("You selected 'Other'. Please fill in a response or type in another choice"):r.errors.push("Your 'Other' input is invalid. Please try again without using special characters or symbols")}),0===r.errors.length},r.internalControl.clean_answer=function(){},r.buildOtherChoices=function(){return otherAnswerArray=_.difference(r.value,_.pluck(r.localChoices,"value")),otherAnswerArray.length>0&&_.each(otherAnswerArray,function(e){var t={verbose:"User Entered",value:e};r.localChoices.splice(r.localChoices.length-1,0,t)}),r.localChoices},r.toggleAnswers=function(e){var t=r.valueArray.indexOf(e);t>-1?r.valueArray.splice(t,1):r.valueArray.push(e),r.valueArray.sort(function(e,t){return e-t}),r.valueArray.length>0?r.value=r.valueArray:r.value},r.otherValueBlur=function(){if(setValue=function(){var e={verbose:"User Entered: "+r.otherValue,value:r.otherValue,checked:!0};r.localChoices.splice(r.localChoices.length-1,0,e),r.value[r.value.indexOf("other")]=r.otherValue,r.localChoices[r.localChoices.length-1].checked=!1,r.showOtherInput=!1,r.otherValue=""},r.otherValue.length>0){if(_.contains(r.value,r.otherValue))return o?o.alert({title:"Duplicate Entries",template:"You have typed a duplicate answer. Please try again."}):alert("You have typed a duplicate answer. Please try again."),r.otherValue="",!1;if(r.otherValue.length>options.other_max_length)return o?o.alert({title:"Too long",template:"You have typed an answer that is too long. Please try again."}):alert("You have typed an answer that is too long. Please try again."),!1;if(o){var e=o.confirm({title:"Are You Sure",template:"Are you sure you want this selection?"});e.then(function(e){e&&setValue()})}else{var t=window.confirm("Are You Sure","Are you sure you want this selection");1==t&&setValue()}}},r.$watchCollection("value",function(e){if(e){var t=e.length;r.choicesSelected=t,r.showOtherInput=_.contains(r.value,"other")?!0:!1}}),e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=a.html(e).contents();n(t)(r)})}}}}]),angular.module("p97.questionTypes").directive("toggle",["$http","$templateCache","$compile",function(e,t,n){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(r,o){if(r.getContentUrl=function(){return r.question.options.templateUrl?BASE_URL+"toggle/templates/"+r.question.options.templateUrl+".html":BASE_URL+"toggle/templates/ionic/toggle.html"},r.question){{r.question.options}r.errors=[],"undefined"!=typeof r.question.value&&(r.localValue=r.question.value),r.internalControl=r.control||{},r.internalControl.validate_answer=function(){return r.value===r.question.options.positiveValue||r.value===r.question.options.negativeValue?!0:void 0},r.internalControl.clean_answer=function(){null===r.value&&(r.value=!1)},r.$watch("localValue",function(e){"undefined"!=typeof e&&(r.value=e===!0?r.question.options.positiveValue||!0:r.question.options.negativeValue||!1,console.log(r.value))}),e.get(r.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();n(t)(r)})}}}}]);