angular.module("p97.questionTypes",[]),angular.module("p97.questionTypes").directive("qtLoader",function(e){return{restrict:"E",scope:{questions:"="},template:"<div class='row blocks'></div>",controller:function(t,r){t.addDirectives=function(){_.each(t.questions,function(n,o){n.form={},"undefined"==typeof n.value&&(n.value="");var a="<div "+n.type+' question="questions['+o+']" value="questions['+o+'].value" control="questions['+o+'].form" cid="questions['+o+'].answerCid"></div>',u=e(a)(t);r.parent().append(u)})},t.addDirectives()}}}),angular.module("p97.questionTypes").directive("datetime",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"datetime/templates/"+n.question.options.templateUrl+".html":BASE_URL+"datetime/templates/ionic/datetime.html"},n.question){var a=n.question.options;n.errors=[],n.internalControl=n.control||{},n.internalControl.validate_answer=function(){n.errors=[];var e=a.datejs_format||"MM/dd/yyyy HH:mm:ss",t=Date.parseExact(n.value,e);return a.required===!0?((null===t||isNaN(t))&&n.errors.push("Invalid format."),0===n.value.length&&n.errors.push("This field is required")):n.value.length>0&&(null===t||0/0===t)&&n.errors.push("Invalid format."),0===n.errors.length},n.internalControl.clean_answer=function(){},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}}),angular.module("p97.questionTypes").directive("number",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"number/templates/"+n.question.options.templateUrl+".html":BASE_URL+"number/templates/ionic/number.html"},n.question){var a=n.question.options;n.errors=[],n.internalControl=n.control||{},n.internalControl.validate_answer=function(){return n.errors=[],"number"!=typeof n.value&&a.required&&a.required===!0?(n.errors.push("input must be a number"),!1):"number"==typeof n.value||a.required&&a.required!==!1?(a.min&&"number"==typeof a.min&&n.value<a.min&&n.errors.push("value must not be less than "+a.min),a.max&&n.value>a.max&&n.errors.push("value must not be more than "+a.max),0===n.errors.length):(n.errors.push("input must be a number"),!1)},n.internalControl.clean_answer=function(){n.value=parseFloat(n.value,10)},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}}),angular.module("p97.questionTypes").directive("textarea",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"textarea/templates/"+n.question.options.templateUrl+".html":BASE_URL+"textarea/templates/ionic/textarea.html"},n.question){var a=n.question.options;n.errors=[],n.char_count=0,n.word_count=0,n.internalControl=n.control||{},n.internalControl.validate_answer=function(){if(n.errors=[],null===n.value&&(n.value=""),a.min_word&&n.word_count<a.min_word&&n.errors.push("You must have at least "+a.min_word+" words. You have "+n.word_count),a.max_word){var e=a.max_count||500;n.word_count>e?n.errors.push("You can have up to "+e+" words. You currently have "+n.word_count):n.word_count>a.max_word&&n.errors.push("You can only have "+a.max_word+" words. You have "+n.word_count)}return!a.min_word&&a.min_char&&n.char_count<a.min_char&&n.errors.push("You must have at least "+a.min_char+" characters. You have "+n.char_count),!a.max_word&&a.max_char&&n.char_count>a.max_char&&n.errors.push("You can only have "+a.max_char+" characters. You have "+n.char_count),0===n.errors.length},n.internalControl.clean_answer=function(){},n.$watch("value",function(e){if(e){var t,r=e.length;t=0===r?0:n.value.split(" ").length||0,n.char_count=r,n.word_count=t}}),e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}}),angular.module("p97.questionTypes").directive("yesNo",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"yes-no/templates/"+n.question.options.templateUrl+".html":BASE_URL+"yes-no/templates/ionic/yes-no.html"},n.question){var a=n.question.options;n.errors=[],n.internalControl=n.control||{},n.internalControl.validate_answer=function(){n.errors=[],a.required&&a.required===!0&&null===n.value&&n.errors.push("This field is required")},n.internalControl.clean_answer=function(){null===n.value&&(n.value=!1)},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}}),angular.module("p97.questionTypes").directive("singleSelect",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"single-select/templates/"+n.question.options.templateUrl+".html":BASE_URL+"single-select/templates/ionic/drop-down-single.html"},n.question){var a=n.question.options;if(n.errors=[],1===n.question.choices.length&&(n.value=n.question.choices[0].value),a.allow_other>0){var u={verbose:"Other",value:"other"};n.question.choices.push(u)}var l=/^[A-Za-z\d() _.,-]*$/;n.internalControl=n.control||{},n.internalControl.validate_answer=function(){return n.errors=[],a.required&&a.required===!0&&null===n.value&&n.errors.push("This field is required"),l.test(n.otherValue)&&l.test(n.value)&&l.test(n.clean)||n.errors.push("Your 'Other' input is invalid. Please try again without using special characters or symbols"),"other"===n.value&&(n.otherValue&&null!==n.otherValue||n.errors.push("You selected 'Other'. It cannot be blank. Please fill in a response or select another choice")),0===n.errors.length},n.internalControl.clean_answer=function(){return n.cleaned_value=n.value,"other"===n.value&&(n.cleaned_value=n.otherValue),n.cleaned_value},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)}),n.otherValueBlur=function(){if(n.otherValue.length>0){var e=window.confirm("Are you sure you want this input?");if(e){var t={verbose:"User Entered: "+n.otherValue,value:n.otherValue};n.question.choices.splice(n.question.choices.length-1,0,t),n.value=n.otherValue,n.otherValue=""}}}}}}}),angular.module("p97.questionTypes").directive("text",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"text/templates/"+n.question.options.templateUrl+".html":BASE_URL+"text/templates/ionic/text.html"},n.question){var a=n.question.options;n.errors=[],n.char_count=0,n.word_count=0,n.internalControl=n.control||{},n.internalControl.validate_answer=function(){if(n.errors=[],null===n.value&&(n.value=""),a.min_word&&n.word_count<a.min_word&&n.errors.push("You must have at least "+a.min_word+" words. You have "+n.word_count),a.max_word){var e=a.max_count||20;n.word_count>e?n.errors.push("You can have up to "+e+" words. You currently have "+n.word_count):n.word_count>a.max_word&&n.errors.push("You can only have "+a.max_word+" words. You have "+n.word_count)}return!a.min_word&&a.min_char&&n.char_count<a.min_char&&n.errors.push("You must have at least "+a.min_char+" characters. You have "+n.char_count),!a.max_word&&a.max_char&&n.char_count>a.max_char&&n.errors.push("You can only have "+a.max_char+" characters. You have "+n.char_count),0===n.errors.length},n.internalControl.clean_answer=function(){},n.$watch("value",function(e){if(e){var t,r=e.length;t=0===r?0:n.value.split(" ").length||0,n.char_count=r,n.word_count=t}}),e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}}),angular.module("p97.questionTypes").directive("integer",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"integer/templates/"+n.question.options.templateUrl+".html":BASE_URL+"integer/templates/ionic/integer.html"},n.question){var a=n.question.options;n.errors=[],n.internalControl=n.control||{},n.internalControl.validate_answer=function(){function e(e){return"number"==typeof e&&e%1===0}return n.errors=[],!e(n.value)&&a.required&&a.required===!0?(n.errors.push("input must be a integer"),!1):e(n.value)||a.required&&a.required!==!1?(a.min&&e(a.min)&&n.value<a.min&&n.errors.push("value must not be less than "+a.min),a.max&&e(a.max)&&n.value>a.max&&n.errors.push("value must not be more than "+a.max),0===n.errors.length):(n.errors.push("input must be a integer"),!1)},n.internalControl.clean_answer=function(){n.value=parseFloat(n.value,10)},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}});var reg=angular.module("p97.questionTypes").directive("email",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"email/templates/"+n.question.options.templateUrl+".html":BASE_URL+"email/templates/ionic/email.html"},n.question){var a=n.question.options;n.errors=[],n.internalControl=n.control||{},n.internalControl.validate_answer=function(){n.errors=[];var e=/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;return!e.test(n.value)&&a.required&&a.required===!0?(n.errors.push("input must be a valid email"),!1):e.test(n.value)||a.required&&a.required!==!1?0===n.errors.length:(n.errors.push("input must be a valid email"),!1)},n.internalControl.clean_answer=function(){},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}});angular.module("p97.questionTypes").directive("date",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"date/templates/"+n.question.options.templateUrl+".html":BASE_URL+"date/templates/ionic/date.html"},n.question){var a=n.question.options;n.errors=[],n.internalControl=n.control||{},n.internalControl.validate_answer=function(){n.errors=[];var e=a.datejs_format||"MM/dd/yyyy",t=Date.parseExact(n.value,e);return a.required===!0?((null===t||isNaN(t))&&n.errors.push("Invalid format."),0===n.value.length&&n.errors.push("This field is required")):n.value.length>0&&(null===t||0/0===t)&&n.errors.push("Invalid format."),0===n.errors.length},n.internalControl.clean_answer=function(){},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}}),angular.module("p97.questionTypes").directive("phonenumber",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"phonenumber/templates/"+n.question.options.templateUrl+".html":BASE_URL+"phonenumber/templates/ionic/phonenumber.html"},n.question){var a=n.question.options;n.errors=[];var u=/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,l=/^[0-9 ]+$/;n.internalControl=n.control||{},n.internalControl.validate_answer=function(){n.errors=[];a.default||"North America";return a.required&&a.required===!0&&null===n.value?(n.errors.push("This field is required"),!1):(a.format&&"North America"===a.format&&(u.test(n.value)||n.errors.push("input must be a valid North America phonenumber")),a.format&&"International"===a.format&&(l.test(n.value)||n.errors.push("input must be a valid International phonenumber")),0===n.errors.length)},n.internalControl.parse_phone=function(){if(a.format&&"North America"===a.format&&u.test(n.value)){var e="+"+a.country+" "+n.value.replace(u,"$1 $2$3");n.parsed_array=e.split(" ")}if(a.format&&"International"===a.format&&l.test(n.value)){var e="+"+a.country+" "+n.value;n.parsed_array=e.split(" ")}return n.parsed_array},n.internalControl.clean_answer=function(){return n.internalControl.cleaned_value=n.internalControl.parse_phone(),n.internalControl.cleaned_value},e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}}),angular.module("p97.questionTypes").directive("multiSelect",function(e,t,r){return{template:"",restrict:"EA",scope:{question:"=",value:"=",control:"="},link:function(n,o){if(n.getContentUrl=function(){return n.question.options.templateUrl?BASE_URL+"multi-select/templates/"+n.question.options.templateUrl+".html":BASE_URL+"multi-select/templates/ionic/drop-down-multi.html"},n.question){var a=n.question.options;n.choices_selected=0,n.errors=[],1===n.question.choices.length&&(n.value=n.question.choices[0].value),n.internalControl=n.control||{},n.internalControl.validate_answer=function(){return n.errors=[],a.required&&a.required===!0&&null===n.value&&n.errors.push("This field is required"),a.max_choice&&n.choices_selected>a.max_choice&&n.errors.push("You can have up to "+a.max_choice+" choices. You currently have "+n.choices_selected),a.min_choice&&n.choices_selected<a.min_choice&&n.errors.push("You need at least "+a.min_choice+" choices. You currently have "+n.choices_selected),0===n.errors.length},n.internalControl.clean_answer=function(){},n.$watch("value",function(e){if(e){var t=e.length;n.choices_selected=t}}),e.get(n.getContentUrl(),{cache:t}).success(function(e){var t=o.html(e).contents();r(t)(n)})}}}});